# Internal Support Ticket System - Project Requirements

## Overview
Build a centralized internal support ticket system to replace WhatsApp/Telegram-based support between HR, Sales, Content, and Tech teams. The system will allow employees to raise and track issues assigned to different teams, with file attachments, chat discussions, and ticket types.

---

## 🛠 Tech Stack

### Frontend
- React + Vite
- Tailwind CSS
- shadcn/ui

### Backend
- Node.js + Express

### Database
- PostgreSQL (external DB)
- ORM: Prisma (recommended)

### Containerization
- Single Docker container hosting frontend + backend
- External PostgreSQL connection

### Authentication
- Auth.js (https://authjs.dev/)
- **Only Google Sign-In**

### File Uploads
- Direct upload to S3 using pre-signed URLs
- Pre-signed URLs generated by backend
- Frontend uploads directly to S3

---

## 🗂 Database Schema Overview (ERD)

### Tables
- `teams` (id, name)
- `employees` (id, name, email, team_id, role)
- `external_users` (id, identifier TEXT, identifier_type TEXT)
- `ticket_statuses` (id, name, description)
- `ticket_priorities` (id, name, description)
- `tickets` (
    id, description, attachment, status_id, priority_id, ticket_category_id,
    raised_by_employee_id, external_user_id (nullable), assigned_to_team_id,
    created_at, updated_at, closed_at
  )
- `ticket_messages` (id, ticket_id, user_id, message, attachment_url, created_at)
- `ticket_categories` (id, name, description, is_active, created_at)

---

## 🔑 Core Features

### 1. Ticket Management
- Only authenticated internal employees can create tickets
- Form includes:
  - Description
  - Optional file attachment
  - Assigned team (dropdown)
  - Priority (dropdown)
  - Category (dropdown)
  - Optional external user identifier (`identifier` + `identifier_type`: mobile/email)
- External user info stored in `external_users` table
- View tickets (filter by team, category, status, etc.)
- Assign tickets to other teams
- Track created/updated/closed timestamps

### 2. Ticket Status Values
Suggested default values in `ticket_statuses` table:
- Open
- In Progress
- Waiting for Response
- Resolved
- Closed
- Reopened

### 3. Ticket Priority Values
Defined in `ticket_priorities` table:
- Low
- Medium
- High
- Urgent

### 4. Ticket Chat
- HTTP-based threaded discussion under each ticket
- Messages contain:
  - Sender (employee)
  - Timestamp
  - Text
  - Optional attachment
- Polling (no WebSockets)

### 5. Ticket Categories
- Managed via `ticket_categories` table
- Admins can add/edit/disable categories
- Each ticket links to a category

---

## 🧭 Sidebar Navigation

For All Users:
- 🏠 Dashboard
- ➕ Create Ticket
- 📄 My Tickets
- 📥 Assigned to My Team

For Admins:
- 🧾 All Tickets
- 👥 Manage Users
- 👨‍👩‍👧‍👦 Manage Teams
- 🧱 Manage Ticket Categories
- 🎯 Manage Ticket Priorities
- 🚦 Manage Statuses
- 📈 Reports

---

## 🔐 Auth Flow Summary
- Google Sign-In using Auth.js
- Auth data managed via JWT session
- Authenticated users can access dashboard and ticket features

---

## 🚀 Deployment Notes
- Single Docker container for full app
- Connects to external PostgreSQL DB
- S3 must support CORS for pre-signed uploads

---

## 🔧 Optional Enhancements
- Auto-suggest team based on ticket category
- Restrict Google sign-ins to `@company.com`
- Optimistic UI for chat
- Admin dashboard for exports (CSV reports)
- File type validation in upload forms

---

## 📌 Deliverables
- React frontend with shadcn/ui
- Express backend with PostgreSQL
- Google login via Auth.js
- Ticket creation, filtering, management
- Chat per ticket
- Admin management of teams, statuses, priorities, categories
- File uploads via pre-signed S3 URLs
- Dockerized deployable system
- Prisma schema + database migrations
